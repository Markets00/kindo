ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 .area _DATA
                              2 .area _CODE
                              3 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              4 .include "player.h.s"
                              1 ;; =========================
                              2 ;; =========================
                              3 ;; PLAYER PUBLIC FUNCTIONS
                              4 ;; =========================
                              5 ;; =========================
                              6 .globl player_erase
                              7 .globl player_update
                              8 .globl player_draw
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                              5 .include "frisbee.h.s"
                              1 ;; =========================
                              2 ;; =========================
                              3 ;; FRISBEE PUBLIC FUNCTIONS
                              4 ;; =========================
                              5 ;; =========================
                              6 .globl frisbee_erase
                              7 .globl frisbee_update
                              8 .globl frisbee_draw
                              9 .globl frisbee_data
                             10 .globl frisbee_setOff
                             11 .globl frisbee_setEffect
                             12 .globl frisbee_setVelocities
                             13 .globl frisbee_checkGoal
                             14 	
                     0017    15 .equ Frisbee_effect_I, 23
                     0018    16 .equ Frisbee_effect_F, 24
                     0008    17 .equ std_eff, 0x0008
                     FFF8    18 .equ std_N_eff, 0xFFF8
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



                              6 .include "utility.h.s"
                              1 ;; ====================================
                              2 ;; ====================================
                              3 ;; INCLUDED CPCTELERA FUNCTIONS
                              4 ;; ====================================
                              5 ;; ====================================
                              6 .globl cpct_waitVSYNC_asm
                              7 .globl cpct_drawSolidBox_asm
                              8 .globl cpct_getScreenPtr_asm
                              9 .globl cpct_scanKeyboard_asm
                             10 .globl cpct_isKeyPressed_asm
                             11 .globl cpct_disableFirmware_asm
                             12 .globl cpct_setVideoMode_asm
                             13 .globl cpct_setPalette_asm
                             14 .globl cpct_memcpy_asm
                             15 .globl negateHL
                             16 .globl cpct_setVideoMemoryPage_asm
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



                              7 .include "game.h.s"
                              1 ;; ====================================
                              2 ;; ====================================
                              3 ;; GAME PUBLIC FUNCTIONS
                              4 ;; ====================================
                              5 ;; ====================================
                              6 .globl gameStart
                              7 .globl getVideoPtr
                              8 .globl incTeam1Points
                              9 .globl incTeam2Points
                             10 
                             11 .macro defineGame name, type, map, fTime
                             12 	name'_data::
                             13 		name'_type::		.db type	;; Game Mode			(8 bits)
                             14 		name'_map::		.dw map		;; Pointer to map of tiles	(16 bits little endian)
                             15 		name'_fTime::		.dw fTime	;; Final duration of each match	(16 bits)
                             16 		name'_t1points:: 	.db 0 		;; Points of team 1		(8 bits)
                             17 		name'_t2points:: 	.db 0 		;; Points of team 2		(8 bits)
                             18 		name'_maxPoints:: 	.db 100 	;; Quantity of points to win	(8 bits)
                             19 .endm
                             20 
                             21 ;; ====================================
                             22 ;; ====================================
                             23 ;; GAME PUBLIC DATA
                             24 ;; ====================================
                             25 ;; ====================================
                     0000    26 .equ Game_type, 	0	;; Game mode
                     0001    27 .equ Game_map_L, 	1	;; Low part of pointer to game map
                     0002    28 .equ Game_map_H, 	2	;; High part of pointer to game map
                     0003    29 .equ Game_fTime_H, 	3	;; High part of final match time
                     0004    30 .equ Game_fTime_L, 	4	;; Low part of final match time
                     0005    31 .equ Game_t1points, 	5	;; Points of team 1
                     0006    32 .equ Game_t2points, 	6	;; Points of team 2
                     0007    33 .equ Game_max_points, 	7	;; maximum of points
                             34 
                     0050    35 .equ RIGHT_LIMIT,	80
                     0000    36 .equ LEFT_LIMIT,	0
                     000A    37 .equ TOP_LIMIT,	 	10
                     00C8    38 .equ BOTTOM_LIMIT,	200
                     0028    39 .equ CENTER_LIMIT,	40
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 6.
Hexadecimal [16-Bits]



                              8 	
                              9 ;; ====================================
                             10 ;; ====================================
                             11 ;; PUBLIC DATA
                             12 ;; ====================================
                             13 ;; ====================================
                             14 
                             15 ;; .equ Game_type, 	0	;; Game mode
                             16 ;; .equ Game_map_L, 	1	;; Low part of pointer to game map
                             17 ;; .equ Game_map_H, 	2	;; High part of pointer to game map
                             18 ;; .equ Game_fTime_H, 	3	;; High part of final match time
                             19 ;; .equ Game_fTime_L, 	4	;; Low part of final match time
                             20 ;; .equ Game_t1points, 	5	;; Points of team 1
                             21 ;; .equ Game_t2points, 	6	;; Points of team 2
                             22 ;; .equ Game_max_points, 	7	;; maximum of points
                             23 ;; 
                             24 ;; .equ RIGHT_LIMIT,	80
                             25 ;; .equ LEFT_LIMIT,	0
                             26 ;; .equ TOP_LIMIT,	 	10
                             27 ;; .equ BOTTOM_LIMIT,	200
                             28 ;; .equ CENTER_LIMIT,	40
                             29 
                             30 
                             31 
                             32 ;; .macro defineGame name, type, map, fTime
   0000                      33 defineGame game, #0, #0x0000, #0x012C
   0000                       1 	game_data::
   0000 00                    2 		game_type::		.db #0	;; Game Mode			(8 bits)
   0001 00 00                 3 		game_map::		.dw #0x0000		;; Pointer to map of tiles	(16 bits little endian)
   0003 2C 01                 4 		game_fTime::		.dw #0x012C	;; Final duration of each match	(16 bits)
   0005 00                    5 		game_t1points:: 	.db 0 		;; Points of team 1		(8 bits)
   0006 00                    6 		game_t2points:: 	.db 0 		;; Points of team 2		(8 bits)
   0007 64                    7 		game_maxPoints:: 	.db 100 	;; Quantity of points to win	(8 bits)
                             34 
                             35 ;; ====================================
                             36 ;; ====================================
                             37 ;; PRIVATE DATA
                             38 ;; ====================================
                             39 ;; ====================================
                             40 
                             41 ;; .equ mi_constante0, 0
                             42 ;; .equ mi_constante1, 1
                             43 	
   0008 00 80                44 videoPtr:	.dw 0x8000
                             45 
                             46 ;; ====================================
                             47 ;; ====================================
                             48 ;; PUBLIC FUNCTIONS
                             49 ;; ====================================
                             50 ;; ====================================
                             51 
                             52 
                             53 ;; ===================================
                             54 ;; Inicia una partida dependiendo
                             55 ;; 	de los atributos de game
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 7.
Hexadecimal [16-Bits]



                             56 ;; ===================================
   000A                      57 gameStart::
                             58 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             59 	;; Reading game data example
                             60 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             61 	;;	ld 	h, Game_type(ix)	;; H <= Game_type
                             62 	;;
                             63 	;;	ld 	h, Game_map_L(ix)
                             64 	;;	ld 	l, Game_map_H(ix) 	;; HL <= Game_map pointer (little endian)
                             65 	;;
                             66 	;;	ld 	h, Game_time_H(ix)
                             67 	;;	ld 	l, Game_time_L(ix)	;; HL <= Game_time
                             68 	
                             69 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
                             70 	;; Modifying game data example
                             71 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             72 	;;	ld 	Game_type(ix), #0	;; Game_type <= 0
                             73 	;;
                             74 	;;	ld 	Game_map_L(ix), #0
                             75 	;;	ld 	Game_map_H(ix), #0 	;; Game_map <= 0x0000 (little endian)
                             76 	;;
                             77 	;;	ld 	Game_time_H(ix), #0
                             78 	;;	ld 	Game_time_L(ix), #0	;; Game_time <= 0x0000
                             79 
                             80 
   000A CD 3B 00      [17]   81 	call 	initializeGame
                             82 	;; Configuration staff...
                             83 	;; Configuration staff...
                             84 	;; Configuration staff...
   000D CD 68 00      [17]   85 	call 	game_loop
   0010 C9            [10]   86 	ret
                             87 
                             88 
                             89 ;; ==================================
                             90 ;; Devuelve el puntero a video en HL
                             91 ;; Devuelve:
                             92 ;;	HL => Pointer to video memory
                             93 ;; ==================================
   0011                      94 getVideoPtr::
   0011 2A 08 00      [16]   95 	ld	hl, (videoPtr)
   0014 C9            [10]   96 	ret
                             97 
                             98 
                             99 ;; ==================================
                            100 ;; Incrementa los puntos del equipo 1
                            101 ;; Modifica: A, IX
                            102 ;; ==================================
   0015                     103 incTeam1Points::
   0015 DD 21 00 00   [14]  104 	ld 	ix, #game_data
   0019 DD 7E 07      [19]  105 	ld	a, Game_max_points(ix)
   001C 47            [ 4]  106 	ld 	b, a				;; B <= Max points
                            107 
   001D DD 7E 05      [19]  108 	ld	a, Game_t1points(ix)
   0020 3C            [ 4]  109 	inc	a				;; A <= Team 1 points + 1
                            110 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 8.
Hexadecimal [16-Bits]



   0021 B8            [ 4]  111 	cp 	b
   0022 28 03         [12]  112 	jr	z, max_t1_points		;; t1Points+1 == max_points? 
   0024 DD 77 05      [19]  113 		ld	Game_t1points(ix), a	;; Inc team 1 points
                            114 
   0027                     115 	max_t1_points:
   0027 C9            [10]  116 		ret
                            117 
                            118 ;; ==================================
                            119 ;; Incrementa los puntos del equipo 2
                            120 ;; Modifica: A, IX
                            121 ;; ==================================
   0028                     122 incTeam2Points::
   0028 DD 21 00 00   [14]  123 	ld 	ix, #game_data
   002C DD 7E 07      [19]  124 	ld	a, Game_max_points(ix)
   002F 47            [ 4]  125 	ld 	b, a				;; B <= Max points
                            126 
   0030 DD 7E 06      [19]  127 	ld	a, Game_t2points(ix)
   0033 3C            [ 4]  128 	inc	a				;; A <= Team 1 points + 1
                            129 
   0034 B8            [ 4]  130 	cp 	b
   0035 28 03         [12]  131 	jr	z, max_t2_points		;; t1Points+1 == max_points? 
   0037 DD 77 05      [19]  132 		ld	Game_t1points(ix), a	;; Inc team 1 points
                            133 
   003A                     134 	max_t2_points:
   003A C9            [10]  135 		ret
                            136 
                            137 ;; ====================================
                            138 ;; ====================================
                            139 ;; PRIVATE FUNCTIONS
                            140 ;; ====================================
                            141 ;; ====================================
                            142 
                            143 
                            144 ;; ========================
                            145 ;; Initialize game
                            146 ;; ========================
   003B                     147 initializeGame:
   003B CD 00 00      [17]  148 	call cpct_disableFirmware_asm
                            149 
                            150 	;; Set video mode
                            151 	;; ld 	c, #0
                            152 	;; call cpct_setVideoMode_asm
                            153 
                            154 	;; Set palette
                            155 	;; ld 	hl, #direccion_paleta
                            156 	;; ld 	de, #16
                            157 	;; call cpct_setPalette_asm
                            158 
                            159 	;; Clean from 8000 to BFFF
   003E 21 00 80      [10]  160 	ld	hl, #0x8000			;; HL <= Copy pointer
   0041 11 01 80      [10]  161 	ld	de, #0x8001			;; DE <= Write pointer
   0044 36 00         [10]  162 	ld	(hl), #00			;; Set to 0 where HL points
   0046 01 00 40      [10]  163 	ld	bc, #0x4000			;; BC <= Times to repeat
   0049 ED B0         [21]  164 	ldir					;; Copy from where HL points to where DE points, and inc HL and DE, BC times
                            165 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 9.
Hexadecimal [16-Bits]



   004B DD 36 05 00   [19]  166 	ld 	Game_t1points(ix), #0
   004F DD 36 06 00   [19]  167 	ld 	Game_t2points(ix), #0		;; Initialize points to 0
                            168 
                            169 	
   0053 C9            [10]  170 	ret
                            171 
                            172 
   0054                     173 switchBuffers:
                     0055   174 	mem_page = .+1
   0054 2E 20         [ 7]  175 	ld 	l, #0x20
   0056 CD 00 00      [17]  176 	call 	cpct_setVideoMemoryPage_asm
   0059 21 55 00      [10]  177 	ld 	hl, #mem_page
   005C 3E 10         [ 7]  178 	ld	a, #0x10
   005E AE            [ 7]  179 	xor	(hl)
   005F 77            [ 7]  180 	ld	(hl), a
                            181 
   0060 21 09 00      [10]  182 	ld	hl, #videoPtr+1
   0063 3E 40         [ 7]  183 	ld	a, #0x40
   0065 AE            [ 7]  184 	xor	(hl)
   0066 77            [ 7]  185 	ld	(hl), a
                            186 
                            187 
   0067 C9            [10]  188 	ret
                            189 
                            190 
                            191 ;; ============================
                            192 ;; Game loop until end of game
                            193 ;; ============================
   0068                     194 game_loop:
                            195 
                            196 
                            197 	;; Erase entities
   0068 CD 00 00      [17]  198 	call player_erase
   006B CD 00 00      [17]  199 	call frisbee_erase
                            200 
                            201 	;; Update entities
   006E CD 00 00      [17]  202 	call player_update
   0071 CD 00 00      [17]  203 	call frisbee_update
                            204 
                            205 	;; Draw entities
   0074 CD 00 00      [17]  206 	call player_draw
   0077 CD 00 00      [17]  207 	call frisbee_draw
                            208 
   007A DD 21 00 00   [14]  209 	ld	ix, #frisbee_data
   007E CD 00 00      [17]  210 	call frisbee_checkGoal
                            211 
                            212 	;; Wait VSYNC to modify VMEM without blinking
   0081 CD 00 00      [17]  213 	call cpct_waitVSYNC_asm
   0084 CD 54 00      [17]  214 	call switchBuffers
                            215 
   0087 18 DF         [12]  216 	jr (game_loop) 			;; Bucle infinito
   0089 C9            [10]  217 	ret
