ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 .area _DATA
                              2 .area _CODE
                              3 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              4 .include "player.h.s"
                              1 ;; =========================
                              2 ;; =========================
                              3 ;; PLAYER PUBLIC FUNCTIONS
                              4 ;; =========================
                              5 ;; =========================
                              6 .globl player_update
                              7 
                              8 .globl _sprite_robot_1_0
                              9 .globl _sprite_robot_1_1
                             10 .globl _sprite_robot_2_0
                             11 .globl _sprite_robot_2_1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                              5 .include "frisbee.h.s"
                              1 ;; =========================
                              2 ;; =========================
                              3 ;; FRISBEE PUBLIC FUNCTIONS
                              4 ;; =========================
                              5 ;; =========================
                              6 .globl frisbee_erase
                              7 .globl frisbee_update
                              8 .globl frisbee_draw
                              9 .globl frisbee_data
                             10 .globl frisbee_setOff
                             11 .globl frisbee_setEffect
                             12 .globl frisbee_setVelocities
                             13 .globl frisbee_checkGoal
                             14 
                             15 .globl _sprite_frisbee_1_0
                             16 .globl _sprite_frisbee_1_1
                             17 	
                     0018    18 .equ Frisbee_effect_I, 24
                     0019    19 .equ Frisbee_effect_F, 25
                     0008    20 .equ std_eff, 0x0008
                     FFF8    21 .equ std_N_eff, 0xFFF8
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



                              6 .include "utility.h.s"
                              1 ;; ====================================
                              2 ;; ====================================
                              3 ;; INCLUDED CPCTELERA FUNCTIONS
                              4 ;; ====================================
                              5 ;; ====================================
                              6 .globl cpct_waitVSYNC_asm
                              7 .globl cpct_drawSolidBox_asm
                              8 .globl cpct_getScreenPtr_asm
                              9 .globl cpct_scanKeyboard_asm
                             10 .globl cpct_isKeyPressed_asm
                             11 .globl cpct_disableFirmware_asm
                             12 .globl cpct_setVideoMode_asm
                             13 .globl cpct_setPalette_asm
                             14 .globl cpct_memcpy_asm
                             15 .globl negateHL
                             16 .globl cpct_setVideoMemoryPage_asm
                             17 .globl cpct_akp_musicPlay_asm
                             18 .globl cpct_akp_stop_asm
                             19 .globl cpct_drawSprite_asm
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



                              7 .include "entity.h.s"
                              1 ;; ====================================
                              2 ;; ====================================
                              3 ;; ENTITY PUBLIC FUNCTIONS
                              4 ;; ====================================
                              5 ;; ====================================
                              6 .globl entityDraw
                              7 .globl entityErase
                              8 .globl entityCheckCollision
                              9 .globl entityUpdatePhysics
                             10 .globl entityUpdatePosition
                             11 
                             12 	
                             13 .globl _sprite_palette
                             14 
                             15 .macro defineEntity name, x,y, h, w, vx, vy, ax, ay, normal, state, sprite, id
                             16 	name'_data::
                             17 		name'_x:	.dw x		;; X coordinate			(16 bits)
                             18 		name'_y:	.dw y		;; Y coordinate			(16 bits)
                             19 		name'_h:	.db h		;; Height			(8 bits)
                             20 		name'_w:	.db w		;; Width			(8 bits)
                             21 		name'_vx:	.dw vx		;; Velocity at X axis 		(16 bits)
                             22 		name'_vy:	.dw vy		;; Velocity at Y axis		(16 bits)
                             23 		name'_ax:	.dw ax		;; Acceleration at X axis	(16 bits)
                             24 		name'_ay:	.dw ay		;; Acceleration at Y axis	(16 bits)
                             25 		name'_normal:	.dw normal	;; Normal force			(16 bits)
                             26 		name'_last_x:	.db x		;; Last x rendered		(8 bits)
                             27 		name'_erase_x:	.db x		;; x rendered at same buffer	(8 bits)
                             28 		name'_last_y:	.db y		;; Last y rendered		(8 bits)
                             29 		name'_erase_y:	.db y		;; y rendered at same buffer	(8 bits)
                             30 		name'_state:	.db state	;; Entity enabled/disabled	(8 bits)
                             31 		name'_sprite:	.dw sprite	;; Entity sprite		(16 bits)
                             32 		name'_id:	.db id		;; Numeric ID			(8 bits)
                             33 .endm
                             34 
                             35 
                             36 ;; ====================================
                             37 ;; ====================================
                             38 ;; ENTITY PUBLIC DATA
                             39 ;; ====================================
                             40 ;; ====================================
                     0000    41 .equ Ent_x_I, 		0	;; X coordinate, integer part
                     0001    42 .equ Ent_x_F, 		1	;; X coordinate, fractional part
                     0002    43 .equ Ent_y_I, 		2	;; Y coordinate, integer part
                     0003    44 .equ Ent_y_F, 		3	;; Y coordinate, fractional part
                     0004    45 .equ Ent_h, 		4	;; Height
                     0005    46 .equ Ent_w, 		5	;; Width
                     0006    47 .equ Ent_vx_I,		6	;; Velocity at X axis, integer part
                     0007    48 .equ Ent_vx_F,		7	;; Velocity at X axis, fractional part
                     0008    49 .equ Ent_vy_I,		8	;; Velocity at Y axis, integer part
                     0009    50 .equ Ent_vy_F,		9	;; Velocity at Y axis, fractional part
                     000A    51 .equ Ent_ax_I,		10	;; Acceleration at X axis, integer part
                     000B    52 .equ Ent_ax_F,		11	;; Acceleration at X axis, fractional part
                     000C    53 .equ Ent_ay_I,		12	;; Acceleration at Y axis, integer part
                     000D    54 .equ Ent_ay_F,		13	;; Acceleration at Y axis, fractional part
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 6.
Hexadecimal [16-Bits]



                     000E    55 .equ Ent_N_I,		14	;; Normal force, integer part
                     000F    56 .equ Ent_N_F,		15	;; Normal force, fractional part
                     0010    57 .equ Ent_last_x,	16	;; Last x rendered
                     0011    58 .equ Ent_erase_x,	17	;; x rendered at same buffer
                     0012    59 .equ Ent_last_y,	18	;; Last y rendered
                     0013    60 .equ Ent_erase_y,	19	;; y rendered at same buffer
                     0014    61 .equ Ent_state,		20	;; Entity enabled/disabled
                     0015    62 .equ Ent_sprite_H, 	21	;; Pointer to sprite, high part
                     0016    63 .equ Ent_sprite_L, 	22	;; Pointer to sprite, low part
                     0017    64 .equ Ent_id, 		23	;; Numeric ID
                             65 				;; Frisbee 	0
                             66 				;; Player1 	1
                             67 				;; Enemy1	2
                             68 
                     0003    69 .equ MAX_VEL_X, 3 
                     FFFFFFFD    70 .equ MIN_VEL_X, -3
                     0003    71 .equ MAX_VEL_Y, 3
                     FFFFFFFD    72 .equ MIN_VEL_Y, -3
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 7.
Hexadecimal [16-Bits]



                              8 	
                              9 ;; ====================================
                             10 ;; ====================================
                             11 ;; PUBLIC DATA
                             12 ;; ====================================
                             13 ;; ====================================
                             14 
                             15 
                             16 .globl _sprite_palette
                             17 .globl _sprite_robot_1_0
                             18 .globl _sprite_robot_1_1
                             19 .globl _sprite_robot_2_0
                             20 .globl _sprite_robot_2_1
                             21 
                             22 
                             23 
                             24 ;;    .macro name,   x,       y,       h,   w,  vx,    vy,    ax,    ay,    normal,  state, sprite,  			id
   0000                      25 defineEntity player, #0x0010, #0x0050, #20, #5, #0000, #0000, #0000, #0000, #0x1800, #1,    #_sprite_robot_1_0, 	#1
   0000                       1 	player_data::
   0000 10 00                 2 		player_x:	.dw #0x0010		;; X coordinate			(16 bits)
   0002 50 00                 3 		player_y:	.dw #0x0050		;; Y coordinate			(16 bits)
   0004 14                    4 		player_h:	.db #20		;; Height			(8 bits)
   0005 05                    5 		player_w:	.db #5		;; Width			(8 bits)
   0006 00 00                 6 		player_vx:	.dw #0000		;; Velocity at X axis 		(16 bits)
   0008 00 00                 7 		player_vy:	.dw #0000		;; Velocity at Y axis		(16 bits)
   000A 00 00                 8 		player_ax:	.dw #0000		;; Acceleration at X axis	(16 bits)
   000C 00 00                 9 		player_ay:	.dw #0000		;; Acceleration at Y axis	(16 bits)
   000E 00 18                10 		player_normal:	.dw #0x1800	;; Normal force			(16 bits)
   0010 10                   11 		player_last_x:	.db #0x0010		;; Last x rendered		(8 bits)
   0011 10                   12 		player_erase_x:	.db #0x0010		;; x rendered at same buffer	(8 bits)
   0012 50                   13 		player_last_y:	.db #0x0050		;; Last y rendered		(8 bits)
   0013 50                   14 		player_erase_y:	.db #0x0050		;; y rendered at same buffer	(8 bits)
   0014 01                   15 		player_state:	.db #1	;; Entity enabled/disabled	(8 bits)
   0015 00 00                16 		player_sprite:	.dw #_sprite_robot_1_0	;; Entity sprite		(16 bits)
   0017 01                   17 		player_id:	.db #1		;; Numeric ID			(8 bits)
   0018                      26 defineEntity enemy, #0x0050-0x0004, #0x0064, #20, #5, #0000, #0000, #0000, #0000, #0x1800, #1, #_sprite_robot_2_0, 	#2
   0018                       1 	enemy_data::
   0018 4C 00                 2 		enemy_x:	.dw #0x0050-0x0004		;; X coordinate			(16 bits)
   001A 64 00                 3 		enemy_y:	.dw #0x0064		;; Y coordinate			(16 bits)
   001C 14                    4 		enemy_h:	.db #20		;; Height			(8 bits)
   001D 05                    5 		enemy_w:	.db #5		;; Width			(8 bits)
   001E 00 00                 6 		enemy_vx:	.dw #0000		;; Velocity at X axis 		(16 bits)
   0020 00 00                 7 		enemy_vy:	.dw #0000		;; Velocity at Y axis		(16 bits)
   0022 00 00                 8 		enemy_ax:	.dw #0000		;; Acceleration at X axis	(16 bits)
   0024 00 00                 9 		enemy_ay:	.dw #0000		;; Acceleration at Y axis	(16 bits)
   0026 00 18                10 		enemy_normal:	.dw #0x1800	;; Normal force			(16 bits)
   0028 4C                   11 		enemy_last_x:	.db #0x0050-0x0004		;; Last x rendered		(8 bits)
   0029 4C                   12 		enemy_erase_x:	.db #0x0050-0x0004		;; x rendered at same buffer	(8 bits)
   002A 64                   13 		enemy_last_y:	.db #0x0064		;; Last y rendered		(8 bits)
   002B 64                   14 		enemy_erase_y:	.db #0x0064		;; y rendered at same buffer	(8 bits)
   002C 01                   15 		enemy_state:	.db #1	;; Entity enabled/disabled	(8 bits)
   002D 00 00                16 		enemy_sprite:	.dw #_sprite_robot_2_0	;; Entity sprite		(16 bits)
   002F 02                   17 		enemy_id:	.db #2		;; Numeric ID			(8 bits)
                             27 
   0030                      28 defineEntity player_2, #0x0010, #0x0050, #20, #5, #0000, #0000, #0000, #0000, #0x1800, #1,    #_sprite_robot_1_0, 	#1
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 8.
Hexadecimal [16-Bits]



   0030                       1 	player_2_data::
   0030 10 00                 2 		player_2_x:	.dw #0x0010		;; X coordinate			(16 bits)
   0032 50 00                 3 		player_2_y:	.dw #0x0050		;; Y coordinate			(16 bits)
   0034 14                    4 		player_2_h:	.db #20		;; Height			(8 bits)
   0035 05                    5 		player_2_w:	.db #5		;; Width			(8 bits)
   0036 00 00                 6 		player_2_vx:	.dw #0000		;; Velocity at X axis 		(16 bits)
   0038 00 00                 7 		player_2_vy:	.dw #0000		;; Velocity at Y axis		(16 bits)
   003A 00 00                 8 		player_2_ax:	.dw #0000		;; Acceleration at X axis	(16 bits)
   003C 00 00                 9 		player_2_ay:	.dw #0000		;; Acceleration at Y axis	(16 bits)
   003E 00 18                10 		player_2_normal:	.dw #0x1800	;; Normal force			(16 bits)
   0040 10                   11 		player_2_last_x:	.db #0x0010		;; Last x rendered		(8 bits)
   0041 10                   12 		player_2_erase_x:	.db #0x0010		;; x rendered at same buffer	(8 bits)
   0042 50                   13 		player_2_last_y:	.db #0x0050		;; Last y rendered		(8 bits)
   0043 50                   14 		player_2_erase_y:	.db #0x0050		;; y rendered at same buffer	(8 bits)
   0044 01                   15 		player_2_state:	.db #1	;; Entity enabled/disabled	(8 bits)
   0045 00 00                16 		player_2_sprite:	.dw #_sprite_robot_1_0	;; Entity sprite		(16 bits)
   0047 01                   17 		player_2_id:	.db #1		;; Numeric ID			(8 bits)
   0048                      29 defineEntity enemy_2, #0x0050-0x0004, #0x0064, #20, #5, #0000, #0000, #0000, #0000, #0x1800, #1, #_sprite_robot_2_0, 	#2
   0048                       1 	enemy_2_data::
   0048 4C 00                 2 		enemy_2_x:	.dw #0x0050-0x0004		;; X coordinate			(16 bits)
   004A 64 00                 3 		enemy_2_y:	.dw #0x0064		;; Y coordinate			(16 bits)
   004C 14                    4 		enemy_2_h:	.db #20		;; Height			(8 bits)
   004D 05                    5 		enemy_2_w:	.db #5		;; Width			(8 bits)
   004E 00 00                 6 		enemy_2_vx:	.dw #0000		;; Velocity at X axis 		(16 bits)
   0050 00 00                 7 		enemy_2_vy:	.dw #0000		;; Velocity at Y axis		(16 bits)
   0052 00 00                 8 		enemy_2_ax:	.dw #0000		;; Acceleration at X axis	(16 bits)
   0054 00 00                 9 		enemy_2_ay:	.dw #0000		;; Acceleration at Y axis	(16 bits)
   0056 00 18                10 		enemy_2_normal:	.dw #0x1800	;; Normal force			(16 bits)
   0058 4C                   11 		enemy_2_last_x:	.db #0x0050-0x0004		;; Last x rendered		(8 bits)
   0059 4C                   12 		enemy_2_erase_x:	.db #0x0050-0x0004		;; x rendered at same buffer	(8 bits)
   005A 64                   13 		enemy_2_last_y:	.db #0x0064		;; Last y rendered		(8 bits)
   005B 64                   14 		enemy_2_erase_y:	.db #0x0064		;; y rendered at same buffer	(8 bits)
   005C 01                   15 		enemy_2_state:	.db #1	;; Entity enabled/disabled	(8 bits)
   005D 00 00                16 		enemy_2_sprite:	.dw #_sprite_robot_2_0	;; Entity sprite		(16 bits)
   005F 02                   17 		enemy_2_id:	.db #2		;; Numeric ID			(8 bits)
                             30 
   0060                      31 game_data::
   0060 00                   32 	game_type::         .db #0 ;; Game Mode (8 bits)
   0061 00                   33    	game_numPlayers:    .db #0 ;; Players who are going to play
   0062 01                   34    	game_WinCondition:  .db #1 ;; Win condition 0-> Time, 1 -> Score
                             35 
   0063 0A                   36 	game_maxScore:      .db #10 ;; Max score of a match (to win)
   0064 00                   37 	game_t1Score:       .db #0 ;; Points of team 1		(8 bits)
   0065 00                   38 	game_t2Score:       .db #0 ;; Points of team 2		(8 bits)
                             39 
   0066 00                   40 	game_time:			.db #0 ;; Actual time of a game
   0067 00 00                41 	game_maxTime:       .dw #0x0000 ;; Max time of a match
   0069 00 00                42 	game_map:           .dw #0x0000 ;; Pointer to map of tiles	(16 bits little endian)
                             43 
   006B 00                   44 	game_interruptions: .db #0 ;; Counter interruption handler	(8 bits)
   006C 00                   45 	game_musicPlayer:   .db #0 ;; Controles the music player
   006D 00                   46 	game_musicEffects:  .db #0 ;; Controles the effects on the match
                             47 
                             48 	;;game_map:		.dw #0x0000	;; Pointer to map of tiles	(16 bits little endian)
                             49 	;;game_fTime:		.dw #0x0000	;; Final duration of each match	(16 bits)
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 9.
Hexadecimal [16-Bits]



                             50 	;;game_t1Score: 		.db #0 		;; Points of team 1		(8 bits)
                             51 	;;game_t2Score: 		.db #0 		;; Points of team 2		(8 bits)
                             52 ;; 
                             53 ;; .equ RIGHT_LIMIT,	80
                             54 ;; .equ LEFT_LIMIT,	0
                             55 ;; .equ TOP_LIMIT,	10
                             56 ;; .equ BOTTOM_LIMIT,	200
                             57 ;; .equ CENTER_LIMIT,	40
                             58 
                             59 
                             60 ;; ====================================
                             61 ;; ====================================
                             62 ;; PRIVATE DATA
                             63 ;; ====================================
                             64 ;; ====================================
                             65 
                             66 ;; .equ mi_constante0, 0
                             67 ;; .equ mi_constante1, 1
                             68 	
   006E 00 80                69 videoPtr:	.dw 0x8000
                             70 
                             71 ;; ====================================
                             72 ;; ====================================
                             73 ;; PUBLIC FUNCTIONS
                             74 ;; ====================================
                             75 ;; ====================================
                             76 
                             77 
                             78 ;; ===================================
                             79 ;; Inicia una partida dependiendo
                             80 ;; 	de los atributos de game
                             81 ;; ===================================
   0070                      82 gameStart::
                             83 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             84 	;; Reading game data example
                             85 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             86 	;;	ld 	h, Game_type(ix)	;; H <= Game_type
                             87 	;;
                             88 	;;	ld 	h, Game_map_L(ix)
                             89 	;;	ld 	l, Game_map_H(ix) 	;; HL <= Game_map pointer (little endian)
                             90 	;;
                             91 	;;	ld 	h, Game_time_H(ix)
                             92 	;;	ld 	l, Game_time_L(ix)	;; HL <= Game_time
                             93 	
                             94 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
                             95 	;; Modifying game data example
                             96 	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             97 	;;	ld 	Game_type(ix), #0	;; Game_type <= 0
                             98 	;;
                             99 	;;	ld 	Game_map_L(ix), #0
                            100 	;;	ld 	Game_map_H(ix), #0 	;; Game_map <= 0x0000 (little endian)
                            101 	;;
                            102 	;;	ld 	Game_time_H(ix), #0
                            103 	;;	ld 	Game_time_L(ix), #0	;; Game_time <= 0x0000
                            104 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 10.
Hexadecimal [16-Bits]



                            105 
   0070 CD BE 00      [17]  106 	call 	initializeGame
                            107 	;; Configuration staff...
                            108 	;; Configuration staff...
                            109 	;; Configuration staff...
   0073 CD F8 00      [17]  110 	call 	game_loop_Player_IA
                            111 
   0076 3A 65 00      [13]  112 	ld 	a, (game_t2Score)
   0079 47            [ 4]  113 	ld 	b, a
                            114 
   007A 3A 64 00      [13]  115 	ld 	a, (game_t1Score)
   007D B8            [ 4]  116 	cp 	b
   007E FA 81 00      [10]  117 	jp 	m, t2_win
                            118 		;; t1 win
                            119 
   0081                     120 	t2_win:
                            121 
                            122 
   0081 C9            [10]  123 	ret
                            124 
                            125 ;; ==================================
                            126 ;; Devuelve el puntero a video en HL
                            127 ;; Devuelve:
                            128 ;;	HL => Pointer to video memory
                            129 ;; ==================================
   0082                     130 getVideoPtr::
   0082 2A 6E 00      [16]  131 	ld	hl, (videoPtr)
   0085 C9            [10]  132 	ret
                            133 
                            134 ;; ==================================
                            135 ;; Incrementa los puntos del equipo 1
                            136 ;; Modifica: A, B
                            137 ;; ==================================
   0086                     138 incTeam1Points::
   0086 3A 63 00      [13]  139 	ld	a, (game_maxScore)
   0089 47            [ 4]  140 	ld 	b, a				;; B <= Max points
                            141 
   008A 3A 64 00      [13]  142 	ld	a, (game_t1Score)
   008D 3C            [ 4]  143 	inc	a				;; A <= Team 1 points + 1
                            144 
   008E 32 64 00      [13]  145 	ld	(game_t1Score), a	;; Inc team 1 points
                            146 
   0091 C9            [10]  147 		ret
                            148 
                            149 ;; ================================== 
                            150 ;; Incrementa los puntos del equipo 2
                            151 ;; Modifica: A, B
                            152 ;; ==================================
   0092                     153 incTeam2Points::
   0092 3A 63 00      [13]  154 	ld	a, (game_maxScore)
   0095 47            [ 4]  155 	ld 	b, a				;; B <= Max points
                            156 
   0096 3A 65 00      [13]  157 	ld	a, (game_t2Score)
   0099 3C            [ 4]  158 	inc	a				;; A <= Team 2 points + 1
                            159 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 11.
Hexadecimal [16-Bits]



   009A 32 65 00      [13]  160 	ld	(game_t2Score), a	;; Inc team 2 points
                            161 
                            162 	;;cp 	b
                            163 	;;jr	z, max_t2_points		;; t2Points+1 == max_points? 
                            164 	;;	ld	(game_t2Score), a	;; Inc team 2 points
                            165 
   009D C9            [10]  166 		ret
                            167 
                            168 ;; alomejor es una función privada
   009E                     169 play_music::
   009E D9            [ 4]  170 	exx
   009F 08            [ 4]  171 	ex af', af
   00A0 F5            [11]  172 	push af
   00A1 C5            [11]  173 	push bc
   00A2 D5            [11]  174 	push de
   00A3 E5            [11]  175 	push hl
                            176 
   00A4 CD 00 00      [17]  177 	call cpct_akp_musicPlay_asm
                            178 
   00A7 E1            [10]  179 	pop hl
   00A8 D1            [10]  180 	pop de
   00A9 C1            [10]  181 	pop bc
   00AA F1            [10]  182 	pop af
   00AB 08            [ 4]  183 	ex af', af
   00AC D9            [ 4]  184 	exx
                            185 
   00AD C9            [10]  186 	ret
                            187 
                            188 ;; alomejor es una función privada
   00AE                     189 stop_music::
   00AE D9            [ 4]  190 	exx
   00AF 08            [ 4]  191 	ex af', af
   00B0 F5            [11]  192 	push af
   00B1 C5            [11]  193 	push bc
   00B2 D5            [11]  194 	push de
   00B3 E5            [11]  195 	push hl
                            196 
   00B4 CD 00 00      [17]  197 	call cpct_akp_stop_asm
                            198 
   00B7 E1            [10]  199 	pop hl
   00B8 D1            [10]  200 	pop de
   00B9 C1            [10]  201 	pop bc
   00BA F1            [10]  202 	pop af
   00BB 08            [ 4]  203 	ex af', af
   00BC D9            [ 4]  204 	exx
                            205 
   00BD C9            [10]  206 	ret
                            207 
                            208 
                            209 ;; ====================================
                            210 ;; ====================================
                            211 ;; PRIVATE FUNCTIONS
                            212 ;; ====================================
                            213 ;; ====================================
                            214 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 12.
Hexadecimal [16-Bits]



                            215 
                            216 ;; ========================
                            217 ;; Initialize game
                            218 ;; ========================
   00BE                     219 initializeGame:
                            220 
                            221 	;; Set video mode
   00BE 0E 00         [ 7]  222 	ld 	c, #0
   00C0 CD 00 00      [17]  223 	call cpct_setVideoMode_asm
                            224 
                            225 	;; Set palette
   00C3 21 00 00      [10]  226 	ld 	hl, #_sprite_palette
   00C6 11 10 00      [10]  227 	ld 	de, #16
   00C9 CD 00 00      [17]  228 	call cpct_setPalette_asm
                            229 
                            230 	;; Clean from 8000 to BFFF
   00CC 21 00 80      [10]  231 	ld	hl, #0x8000			;; HL <= Copy pointer
   00CF 11 01 80      [10]  232 	ld	de, #0x8001			;; DE <= Write pointer
   00D2 36 00         [10]  233 	ld	(hl), #00			;; Set to 0 where HL points
   00D4 01 00 40      [10]  234 	ld	bc, #0x4000			;; BC <= Times to repeat
   00D7 ED B0         [21]  235 	ldir					;; Copy from where HL points to where DE points, and inc HL and DE, BC times
                            236 
   00D9 21 64 00      [10]  237 	ld	hl, #game_t1Score
   00DC 36 00         [10]  238 	ld 	(hl), #0
   00DE 21 65 00      [10]  239 	ld	hl, #game_t2Score
   00E1 36 00         [10]  240 	ld 	(hl), #0		;; Initialize points to 0
                            241 
                            242 	
   00E3 C9            [10]  243 	ret
                            244 
                            245 
                            246 ;; ========================
                            247 ;; Switch Buffers
                            248 ;; ========================
   00E4                     249 switchBuffers:
                     00E5   250 	mem_page = .+1
   00E4 2E 20         [ 7]  251 	ld 	l, #0x20
   00E6 CD 00 00      [17]  252 	call 	cpct_setVideoMemoryPage_asm
   00E9 21 E5 00      [10]  253 	ld 	hl, #mem_page
   00EC 3E 10         [ 7]  254 	ld	a, #0x10
   00EE AE            [ 7]  255 	xor	(hl)
   00EF 77            [ 7]  256 	ld	(hl), a
                            257 
   00F0 21 6F 00      [10]  258 	ld	hl, #videoPtr+1
   00F3 3E 40         [ 7]  259 	ld	a, #0x40
   00F5 AE            [ 7]  260 	xor	(hl)
   00F6 77            [ 7]  261 	ld	(hl), a
                            262 
                            263 
   00F7 C9            [10]  264 	ret
                            265 
                            266 ;; ============================
                            267 ;; Game loop until end of game
                            268 ;; ============================
   00F8                     269 game_loop_Player_IA:
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 13.
Hexadecimal [16-Bits]



                            270 
                            271 	;; Erase
   00F8 DD 21 00 00   [14]  272 	ld ix, #player_data
   00FC CD 00 00      [17]  273 	call entityErase
                            274 
   00FF DD 21 18 00   [14]  275 	ld ix, #enemy_data
   0103 CD 00 00      [17]  276 	call entityErase
                            277 
   0106 DD 21 00 00   [14]  278 	ld ix, #frisbee_data
   010A CD 00 00      [17]  279 	call entityErase
                            280 
                            281 	;; Update
   010D DD 21 00 00   [14]  282 	ld ix, #player_data
   0111 CD 00 00      [17]  283 	call player_update
                            284 
   0114 DD 21 18 00   [14]  285 	ld ix, #enemy_data
   0118 CD 00 00      [17]  286 	call player_update
                            287 
   011B DD 21 00 00   [14]  288 	ld ix, #frisbee_data
   011F CD 00 00      [17]  289 	call frisbee_update
                            290 
                            291 	;; Draw
   0122 DD 21 00 00   [14]  292 	ld ix, #player_data
   0126 CD 00 00      [17]  293 	call entityDraw
                            294 
   0129 DD 21 18 00   [14]  295 	ld ix, #enemy_data
   012D CD 00 00      [17]  296 	call entityDraw
                            297 
   0130 DD 21 00 00   [14]  298 	ld ix, #frisbee_data
   0134 CD 00 00      [17]  299 	call entityDraw
                            300 
                            301 	;; Check goal
   0137 DD 21 00 00   [14]  302 	ld	ix, #frisbee_data
   013B CD 00 00      [17]  303 	call frisbee_checkGoal
                            304 
                            305 	;; Wait VSYNC to modify VMEM without blinking
   013E CD 00 00      [17]  306 	call cpct_waitVSYNC_asm
   0141 CD E4 00      [17]  307 	call switchBuffers
                            308 
   0144 3A 62 00      [13]  309 	ld a, (game_WinCondition) ;; a <- WinCondition (0-> Time, 1 -> Score)
   0147 FE 00         [ 7]  310 	cp #0  				      ;; a - 0
   0149 28 02         [12]  311 	jr z, timeWinning         ;; if (a - 0) == 0, then jump timeWinning
   014B 18 0C         [12]  312 		jr scoreEnd 		  ;; else, jump ScoreWinning.
                            313 
   014D                     314 	timeWinning:
   014D 3A 66 00      [13]  315 		ld a, (game_time)
   0150 47            [ 4]  316 		ld b, a 				   ;; b <- timeActual
   0151 3A 67 00      [13]  317 		ld a, (game_maxTime)       ;; a <- maxTime
   0154 B8            [ 4]  318 		cp b             	 	   ;; a - b 
   0155 28 17         [12]  319 		jr z, exit 		 	       ;; if (maxTime - timeActual) == 0, then jump timesUp
   0157 18 9F         [12]  320 			jr game_loop_Player_IA ;; Keep Playing
                            321 
   0159                     322 	timesUP:
                            323 		;; Check Scores to know who wins.
                            324 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 14.
Hexadecimal [16-Bits]



   0159                     325 	scoreEnd:
   0159 3A 64 00      [13]  326 		ld a, (game_t1Score) 
   015C 47            [ 4]  327 		ld b, a               ;; b <- LocalScore
   015D 3A 63 00      [13]  328 		ld a, (game_maxScore) ;; a <- maxScore
   0160 B8            [ 4]  329 		cp b             	  ;; a - b 
   0161 28 0B         [12]  330 		jr z, exit 		      ;; if (maxScore - LocalScore) == 0, then jump localWin
                            331 
   0163 4F            [ 4]  332 		ld c, a      	      ;; c <- maxScore
   0164 3A 65 00      [13]  333 		ld a, (game_t2Score)
   0167 47            [ 4]  334 		ld b, a               ;; b <- VisitantScore
   0168 79            [ 4]  335 		ld a, c 			  ;; a <- c
   0169 B8            [ 4]  336 		cp b             	  ;; a - b 
   016A 28 02         [12]  337 		jr z, exit            ;; if (maxScore - VisitantScore) == 0, then jump visitantWin
   016C 18 8A         [12]  338 			jr game_loop_Player_IA ;; Keep Playing
                            339 
   016E                     340 exit:
   016E C9            [10]  341 	ret
